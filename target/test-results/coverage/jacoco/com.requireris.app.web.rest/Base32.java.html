<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Base32.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Requireris</a> &gt; <a href="index.source.html" class="el_package">com.requireris.app.web.rest</a> &gt; <span class="el_source">Base32.java</span></div><h1>Base32.java</h1><pre class="source lang-java linenums">package com.requireris.app.web.rest;

import java.io.*;

/**
 * Routines for converting between Strings of Base32-encoded data and arrays
 * of binary data.  This currently supports the Base32 and Base32hex alphabets
 * specified in RFC 4648, sections 6 and 7.
 *
 * @author Brian Wellington
 */

public class Base32 {

	public static class Alphabet {
<span class="nc" id="L16">		private Alphabet() {}</span>

		public static final String BASE32 =
				&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=&quot;;
		public static final String BASE32HEX =
				&quot;0123456789ABCDEFGHIJKLMNOPQRSTUV=&quot;;
	};
/**
 * Routines for converting between Strings of Base32-encoded data and arrays
 * of binary data.  This currently supports the Base32 and Base32hex alphabets
 * specified in RFC 4648, sections 6 and 7.
 *
 * @author Brian Wellington
 */

	private String alphabet;
	private boolean padding, lowercase;

	/**
	 * Creates an object that can be used to do Base32 conversions.
	 * @param alphabet Which alphabet should be used
	 * @param padding Whether padding should be used
	 * @param lowercase Whether lowercase characters should be used.
	 * default parameters (The standard Base32 alphabet, no padding, uppercase)
	 */
	public
<span class="nc" id="L42">	Base32(String alphabet, boolean padding, boolean lowercase) {</span>
<span class="nc" id="L43">		this.alphabet = alphabet;</span>
<span class="nc" id="L44">		this.padding = padding;</span>
<span class="nc" id="L45">		this.lowercase = lowercase;</span>
<span class="nc" id="L46">	}</span>

	static private int
	blockLenToPadding(int blocklen) {
<span class="nc bnc" id="L50" title="All 6 branches missed.">		switch (blocklen) {</span>
			case 1:
<span class="nc" id="L52">				return 6;</span>
			case 2:
<span class="nc" id="L54">				return 4;</span>
			case 3:
<span class="nc" id="L56">				return 3;</span>
			case 4:
<span class="nc" id="L58">				return 1;</span>
			case 5:
<span class="nc" id="L60">				return 0;</span>
			default:
<span class="nc" id="L62">				return -1;</span>
		}
	}

	static private int
	paddingToBlockLen(int padlen) {
<span class="nc bnc" id="L68" title="All 6 branches missed.">		switch (padlen) {</span>
			case 6:
<span class="nc" id="L70">				return 1;</span>
			case 4:
<span class="nc" id="L72">				return 2;</span>
			case 3:
<span class="nc" id="L74">				return 3;</span>
			case 1:
<span class="nc" id="L76">				return 4;</span>
			case 0:
<span class="nc" id="L78">				return 5;</span>
			default :
<span class="nc" id="L80">				return -1;</span>
		}
	}

	/**
	 * Convert binary data to a Base32-encoded String
	 *
	 * @param b An array containing binary data
	 * @return A String containing the encoded data
	 */
	public String
	toString(byte [] b) {
<span class="nc" id="L92">		ByteArrayOutputStream os = new ByteArrayOutputStream();</span>

<span class="nc bnc" id="L94" title="All 2 branches missed.">		for (int i = 0; i &lt; (b.length + 4) / 5; i++) {</span>
<span class="nc" id="L95">			short s[] = new short[5];</span>
<span class="nc" id="L96">			int t[] = new int[8];</span>

<span class="nc" id="L98">			int blocklen = 5;</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">			for (int j = 0; j &lt; 5; j++) {</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">				if ((i * 5 + j) &lt; b.length)</span>
<span class="nc" id="L101">					s[j] = (short) (b[i * 5 + j] &amp; 0xFF);</span>
				else {
<span class="nc" id="L103">					s[j] = 0;</span>
<span class="nc" id="L104">					blocklen--;</span>
				}
			}
<span class="nc" id="L107">			int padlen = blockLenToPadding(blocklen);</span>

			// convert the 5 byte block into 8 characters (values 0-31).

			// upper 5 bits from first byte
<span class="nc" id="L112">			t[0] = (byte) ((s[0] &gt;&gt; 3) &amp; 0x1F);</span>
			// lower 3 bits from 1st byte, upper 2 bits from 2nd.
<span class="nc" id="L114">			t[1] = (byte) (((s[0] &amp; 0x07) &lt;&lt; 2) | ((s[1] &gt;&gt; 6) &amp; 0x03));</span>
			// bits 5-1 from 2nd.
<span class="nc" id="L116">			t[2] = (byte) ((s[1] &gt;&gt; 1) &amp; 0x1F);</span>
			// lower 1 bit from 2nd, upper 4 from 3rd
<span class="nc" id="L118">			t[3] = (byte) (((s[1] &amp; 0x01) &lt;&lt; 4) | ((s[2] &gt;&gt; 4) &amp; 0x0F));</span>
			// lower 4 from 3rd, upper 1 from 4th.
<span class="nc" id="L120">			t[4] = (byte) (((s[2] &amp; 0x0F) &lt;&lt; 1) | ((s[3] &gt;&gt; 7) &amp; 0x01));</span>
			// bits 6-2 from 4th
<span class="nc" id="L122">			t[5] = (byte) ((s[3] &gt;&gt; 2) &amp; 0x1F);</span>
			// lower 2 from 4th, upper 3 from 5th;
<span class="nc" id="L124">			t[6] = (byte) (((s[3] &amp; 0x03) &lt;&lt; 3) | ((s[4] &gt;&gt; 5) &amp; 0x07));</span>
			// lower 5 from 5th;
<span class="nc" id="L126">			t[7] = (byte) (s[4] &amp; 0x1F);</span>

			// write out the actual characters.
<span class="nc bnc" id="L129" title="All 2 branches missed.">			for (int j = 0; j &lt; t.length - padlen; j++) {</span>
<span class="nc" id="L130">				char c = alphabet.charAt(t[j]);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">				if (lowercase)</span>
<span class="nc" id="L132">					c = Character.toLowerCase(c);</span>
<span class="nc" id="L133">				os.write(c);</span>
			}

			// write out the padding (if any)
<span class="nc bnc" id="L137" title="All 2 branches missed.">			if (padding) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">				for (int j = t.length - padlen; j &lt; t.length; j++)</span>
<span class="nc" id="L139">					os.write('=');</span>
			}
		}

<span class="nc" id="L143">		return new String(os.toByteArray());</span>
	}

	/**
	 * Convert a Base32-encoded String to binary data
	 *
	 * @param str A String containing the encoded data
	 * @return An array containing the binary data, or null if the string is invalid
	 */
	public byte[]
	fromString(String str) {
<span class="nc" id="L154">		ByteArrayOutputStream bs = new ByteArrayOutputStream();</span>
<span class="nc" id="L155">		byte [] raw = str.getBytes();</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">		for (int i = 0; i &lt; raw.length; i++)</span>
		{
<span class="nc" id="L158">			char c = (char) raw[i];</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">			if (!Character.isWhitespace(c)) {</span>
<span class="nc" id="L160">				c = Character.toUpperCase(c);</span>
<span class="nc" id="L161">				bs.write((byte) c);</span>
			}
		}

<span class="nc bnc" id="L165" title="All 2 branches missed.">		if (padding) {</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">			if (bs.size() % 8 != 0)</span>
<span class="nc" id="L167">				return null;</span>
		} else {
<span class="nc bnc" id="L169" title="All 2 branches missed.">			while (bs.size() % 8 != 0)</span>
<span class="nc" id="L170">				bs.write('=');</span>
		}

<span class="nc" id="L173">		byte [] in = bs.toByteArray();</span>

<span class="nc" id="L175">		bs.reset();</span>
<span class="nc" id="L176">		DataOutputStream ds = new DataOutputStream(bs);</span>

<span class="nc bnc" id="L178" title="All 2 branches missed.">		for (int i = 0; i &lt; in.length / 8; i++) {</span>
<span class="nc" id="L179">			short[] s = new short[8];</span>
<span class="nc" id="L180">			int[] t = new int[5];</span>

<span class="nc" id="L182">			int padlen = 8;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">			for (int j = 0; j &lt; 8; j++) {</span>
<span class="nc" id="L184">				char c = (char) in[i * 8 + j];</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">				if (c == '=')</span>
<span class="nc" id="L186">					break;</span>
<span class="nc" id="L187">				s[j] = (short) alphabet.indexOf(in[i * 8 + j]);</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">				if (s[j] &lt; 0)</span>
<span class="nc" id="L189">					return null;</span>
<span class="nc" id="L190">				padlen--;</span>
			}
<span class="nc" id="L192">			int blocklen = paddingToBlockLen(padlen);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">			if (blocklen &lt; 0)</span>
<span class="nc" id="L194">				return null;</span>

			// all 5 bits of 1st, high 3 (of 5) of 2nd
<span class="nc" id="L197">			t[0] = (s[0] &lt;&lt; 3) | s[1] &gt;&gt; 2;</span>
			// lower 2 of 2nd, all 5 of 3rd, high 1 of 4th
<span class="nc" id="L199">			t[1] = ((s[1] &amp; 0x03) &lt;&lt; 6) | (s[2] &lt;&lt; 1) | (s[3] &gt;&gt; 4);</span>
			// lower 4 of 4th, high 4 of 5th
<span class="nc" id="L201">			t[2] = ((s[3] &amp; 0x0F) &lt;&lt; 4) | ((s[4] &gt;&gt; 1) &amp; 0x0F);</span>
			// lower 1 of 5th, all 5 of 6th, high 2 of 7th
<span class="nc" id="L203">			t[3] = (s[4] &lt;&lt; 7) | (s[5] &lt;&lt; 2) | (s[6] &gt;&gt; 3);</span>
			// lower 3 of 7th, all of 8th
<span class="nc" id="L205">			t[4] = ((s[6] &amp; 0x07) &lt;&lt; 5) | s[7];</span>

			try {
<span class="nc bnc" id="L208" title="All 2 branches missed.">				for (int j = 0; j &lt; blocklen; j++)</span>
<span class="nc" id="L209">					ds.writeByte((byte) (t[j] &amp; 0xFF));</span>
			}
<span class="nc" id="L211">			catch (IOException e) {</span>
<span class="nc" id="L212">			}</span>
		}

<span class="nc" id="L215">		return bs.toByteArray();</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>